[tool.black]
line-length = 100
target-version = ["py312"]
extend-exclude = """
(
  ^alembic/|
  ^js/|
  ^node_modules/|
  ^dist/|
  ^build/|
  ^docs/_build/
)
"""

[tool.ruff]
target-version = "py312"
line-length = 100
src = ["api", "tests"]
respect-gitignore = true
extend-exclude = [
  "alembic",
  "js",
  "node_modules",
  "dist",
  "build",
  "docs/_build",
]

[tool.ruff.lint]
# Pyflakes/pycodestyle/isort/pyupgrade/bugbear/comprehensions/unused-args family
select = ["F", "E", "W", "I", "UP", "B", "C4", "ARG", "RUF"]
# let Black own line length
extend-ignore = ["E501"]
fixable = ["ALL"]
unfixable = []

# isort tuning (Ruff implements isort)
[tool.ruff.lint.isort]
known-first-party = ["api"]
combine-as-imports = true

# targeted ignores
[tool.ruff.lint.per-file-ignores]
# FastAPI endpoints: allow Depends/Query/Body in defaults
"api/**/*.py" = ["B008"]
"auth_service/**/*.py" = ["B008"]

"tests/**" = ["ARG", "S101", "ARG001", "ARG002"]
"api/tests/**" = ["ARG", "S101", "ARG001", "ARG002"]

# Allow re-exports in package init files
"api/**/__init__.py" = ["F401"]

[tool.mypy]
python_version = "3.12"
files = ["api"]
plugins = ["pydantic.mypy", "sqlalchemy.ext.mypy.plugin"]

# Reporting / strictness
show_error_codes = true
warn_unused_ignores = true
warn_redundant_casts = true
warn_return_any = true
no_implicit_optional = true
strict_optional = true
check_untyped_defs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true

# 3rd-party libs without stubs
ignore_missing_imports = true

# Skip non-Python areas & tests (you can remove the tests bit later if you want to type-check them)
exclude = "(^alembic/|^js/|^node_modules/|^dist/|^build/|^docs/_build/|^api/tests/)"

# If we prefer to keep tests included but silence them, use this override
# and remove "^api/tests/" from exclude above.
[[tool.mypy.overrides]]
module = ["api.tests.*"]
ignore_errors = true

[tool.pydantic-mypy]
init_forbid_extra = true
init_typed = true
warn_untyped_fields = true